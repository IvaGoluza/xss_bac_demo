"use client"

import { useState } from 'react';
import DOMPurify from 'dompurify';

export default function XSSvulnerability() {
  const [input, setInput] = useState('');
  const [isVulnerable, setIsVulnerable] = useState(false);

  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setInput(e.target.value);
  };

  const checkboxHandler = () => {
    setIsVulnerable(!isVulnerable);
  };

  const handleRenderClick = () => {
    let sanitizedInput = input;
    const vulnerableDiv = document.getElementById('vulnerableDiv');

    if(vulnerableDiv){
      if (!isVulnerable) sanitizedInput = DOMPurify.sanitize(input);
      vulnerableDiv && (vulnerableDiv.innerHTML = `<div>${"Pozdrav, " + sanitizedInput}</div>`);
      const scripts = Array.from(vulnerableDiv.getElementsByTagName('script'));
      scripts && (scripts.forEach(script => {
          try {
             eval(script.innerHTML);
          } catch (error) {
             console.error(error);
          }
      }))
    }
  };

  return (
    <div>

        <div className="mt-1 flex gap-1 items-center">
           <input
              id="checkboxVulnerability"
              type="checkbox"
              className="h-5 w-5 cursor-pointer peer"
              checked={isVulnerable}
              onChange={checkboxHandler}
            />
            <label
              htmlFor="checkboxVulnerability"
              className="cursor-pointer text-white font-bold peer-checked:text-red-500"
            >
            Uključena ranjivost
            </label>
        </div>
        <div className="bg-slate-700 w-full rounded-md h-96 mt-5 p-8">
          <div className='flex flex-row gap-4'>
           <div className="flex flex-col gap-1 items-start w-5/6">
              <label
                  htmlFor="userName"
                  className="text-slate-300 font-bold"
              >
              Unesite korisničko ime
              </label>
              <input
                  className="rounded-md px-3 py-1 w-full"
                  id="userName"
                  type="text"
                  value={input}
                  onChange={handleInputChange}
               />
           </div>
           <button className="mt-8 border border-white text-white rounded-lg p-1 text-xs h-7 w-7 font-bold" onClick={handleRenderClick}>OK</button>
          </div>
          <div className="mt-10 font-bold text-yellow-300 text-xl" id="vulnerableDiv"></div>
        </div>
    </div>
  );
}
